# Module 4: Plugins & Marketplace Architecture

**Duration: ~45 minutes**
**Format:** Hands-on Workshop

---

## What You'll Learn

- How to create a `create-plugin` skill that packages components into installable plugins
- How to create a `create-marketplace` skill that builds a marketplace catalogue
- How to package the feature lifecycle components from Module 2 into a plugin
- How to register the plugin in a marketplace and publish it to a Git repo
- How to install plugins from a marketplace into any project

## Prerequisites

- Completed [Module 2: Key Components](./02_key_components.md) — all skills, agents, and the slash command created
- Completed [Module 3: Marketplace Intro](./03_marketplace_intro.md) — understand what plugins and the marketplace are
- Pre-built `skill-creator` skill available

---

## 1. Overview: What We're Doing (3 min)

In Module 2 you built components. In Module 3 you learned why distributing them matters. Now you'll build the tools to **package** and **distribute** them.

```
┌───────────┐     ┌───────────┐     ┌───────────┐     ┌───────────┐
│  1. Build │ ──► │ 2. Package│ ──► │ 3. Publish│ ──► │ 4. Install│
│     ✅    │     │           │     │           │     │           │
│ (Module 2)│     │ THIS      │     │ THIS      │     │ THIS      │
│           │     │ MODULE    │     │ MODULE    │     │ MODULE    │
└───────────┘     └───────────┘     └───────────┘     └───────────┘
```

You'll create two new skills:

| Skill | Purpose |
|-------|---------|
| `create-plugin` | Packages selected components into a plugin with `plugin.json` |
| `create-marketplace` | Creates or updates a `marketplace.json` catalogue |

Then you'll **use** those skills to package the feature lifecycle and register it in a marketplace.

---

## 2. Create the Create-Plugin Skill (10 min)

This skill lets you select which components to include in a plugin, generalises them to be team-agnostic, and bundles them into a plugin folder with a manifest.

In your Claude Code session, type:

```
/skill-creator Create a skill called "create-plugin"

The skill should:
- Ask the user to provide a name for the new plugin
- Ask the user which components to include in the plugin. The user
  can select any combination of:
  - MCP server configurations (from .mcp.json)
  - Skills (from .claude/skills/)
  - Subagents (from .claude/agents/)
  - Slash commands (from .claude/commands/)
- List the available components in each category so the user can
  choose by name

Once the user selects the components, the skill should:

1. Create the plugin folder structure:
   .claude-plugins/<plugin-name>/
   ├── plugin.json
   ├── skills/        (if skills selected)
   ├── agents/        (if agents selected)
   ├── commands/      (if commands selected)
   └── mcp/           (if MCP configs selected)

2. For each selected component, read its definition and GENERALISE it
   to be reusable across different teams and tech stacks:
   - Remove hardcoded tech stack references (e.g., "React with TypeScript",
     "FastAPI with Python") from agent and skill instructions
   - Replace them with a step that says "Discover the project's tech
     stack by reading CLAUDE.md and exploring the codebase"
   - Keep the workflow logic, process steps, and methodology intact
   - Keep skill injection references (e.g., skills: tdd-workflow) intact
   This makes the plugin useful for ANY project, not just the Tea Store

3. Copy the generalised components into the plugin folder

4. Generate a plugin.json manifest with:
   {
     "name": "<plugin-name>",
     "version": "1.0.0",
     "description": "<auto-generated from components>",
     "author": "<ask the user>",
     "components": {
       "skills": ["<list of included skill names>"],
       "agents": ["<list of included agent names>"],
       "commands": ["<list of included command names>"],
       "mcp": ["<list of included MCP server names>"]
     },
     "dependencies": {
       "mcp": ["<MCP servers required by included components>"]
     }
   }

5. Report what was created and where
```

**Review the generated skill:**

```bash
.claude/skills/create-plugin/SKILL.md
```

Verify it includes:
- Interactive component selection across all four types
- Generalisation logic that strips tech stack specifics
- Proper plugin folder structure creation
- `plugin.json` manifest generation

---

## 3. Create the Create-Marketplace Skill (10 min)

This skill creates or updates a marketplace catalogue file that lists all available plugins.

In your Claude Code session, type:

```
/skill-creator Create a skill called "create-marketplace"

The skill should:
- Scan the .claude-plugins/ folder for all plugin subfolders
- Read each plugin's plugin.json manifest
- Create or update a marketplace.json file inside the .claude-plugins/
  folder that catalogues all discovered plugins

The marketplace.json format should be:
{
  "name": "<ask the user for the marketplace name>",
  "description": "<ask the user>",
  "version": "1.0.0",
  "plugins": [
    {
      "name": "<from plugin.json>",
      "version": "<from plugin.json>",
      "description": "<from plugin.json>",
      "author": "<from plugin.json>",
      "path": "<relative path to plugin folder>",
      "components": {
        "skills": ["<list>"],
        "agents": ["<list>"],
        "commands": ["<list>"],
        "mcp": ["<list>"]
      }
    }
  ]
}

If marketplace.json already exists:
- Read it and merge new plugins into the existing list
- Update entries for plugins that already exist (by name)
- Preserve plugins that are in the file but not in .claude-plugins/

Report the final marketplace contents when done
```

**Review the generated skill:**

```bash
.claude/skills/create-marketplace/SKILL.md
```

Verify it includes:
- Scanning `.claude-plugins/` for plugin folders
- Reading `plugin.json` from each plugin
- Creating or updating `marketplace.json`
- Merge logic for existing marketplaces

### Restart and Verify

Restart Claude Code to load both new skills:

```bash
/exit
claude
```

Verify they appear:

```
/skills
```

You should see `create-plugin` and `create-marketplace` alongside your Module 2 skills.

---

## 4. Package the Feature Lifecycle Plugin (10 min)

Now use the `create-plugin` skill to package everything you built in Module 2 into a single plugin.

In your Claude Code session, type:

```
/create-plugin Create a plugin called "feature-lifecycle" that includes:

MCP servers:
- atlassian (the Jira MCP server)

Skills:
- create-ticket
- expand-ticket
- tdd-workflow
- create-branch
- commit-and-merge

Subagents:
- planner
- tdd-implementer
- code-reviewer

Slash commands:
- implement-feature

Author: "<your name>"
```

The skill should:
1. Create `.claude-plugins/feature-lifecycle/`
2. Generalise each component (strip Tea Store tech stack references)
3. Copy generalised versions into the plugin folder
4. Generate `plugin.json`

### Verify the Plugin

Check the created structure:

```bash
.claude-plugins/feature-lifecycle/
├── plugin.json
├── mcp/
│   └── atlassian.json
├── skills/
│   ├── create-ticket/
│   │   └── SKILL.md
│   ├── expand-ticket/
│   │   └── SKILL.md
│   ├── tdd-workflow/
│   │   └── SKILL.md
│   ├── create-branch/
│   │   └── SKILL.md
│   └── commit-and-merge/
│       └── SKILL.md
├── agents/
│   ├── planner.md
│   ├── tdd-implementer.md
│   └── code-reviewer.md
└── commands/
    └── implement-feature.md
```

Open `plugin.json` and verify it lists all components and declares the Jira MCP dependency.

Spot-check a generalised agent (e.g., `planner.md`) — it should say something like "Discover the project's tech stack by reading CLAUDE.md" instead of "React with TypeScript, FastAPI with Python".

---

## 5. Create the Marketplace (5 min)

Now use the `create-marketplace` skill to register the plugin in a marketplace catalogue.

In your Claude Code session, type:

```
/create-marketplace Create a marketplace from the plugins in .claude-plugins/

Marketplace name: "Pandora Marketplace"
Description: "Organisation-level plugins for Pandora development teams"
```

### Verify the Marketplace

Check the generated file:

```bash
.claude-plugins/marketplace.json
```

It should contain one entry — the `feature-lifecycle` plugin — with its full component list and metadata.

### Current State

```
.claude-plugins/
├── marketplace.json                  ← Marketplace catalogue
└── feature-lifecycle/                ← Plugin
    ├── plugin.json
    ├── mcp/
    ├── skills/
    ├── agents/
    └── commands/
```

---

## 6. Publish to a Marketplace Repo (5 min)

> **Note:** In this module you'll understand the publishing process. You do **not** need to push to a remote repo right now.

Publishing means copying the `.claude-plugins/` contents into the marketplace Git repository and pushing.

### The Process

```
Your Project                              Marketplace Repo
(.claude-plugins/)                        (claude_code_marketplace_demo)

marketplace.json        ──copy──►         marketplace.json
feature-lifecycle/      ──copy──►         plugins/feature-lifecycle/
  ├── plugin.json                           ├── plugin.json
  ├── skills/                               ├── skills/
  ├── agents/                               ├── agents/
  ├── commands/                             ├── commands/
  └── mcp/                                  └── mcp/
```

In practice the steps would be:

1. **Copy** the plugin folder and `marketplace.json` into the marketplace repo
2. **Commit** with a message like `feat: add feature-lifecycle plugin v1.0.0`
3. **Tag** the release: `git tag feature-lifecycle-v1.0.0`
4. **Push** to the remote: `git push origin main --tags`

The marketplace repo then becomes the source of truth. Any team can browse `marketplace.json` to see what's available and install what they need.

### Marketplace Repo Structure

After publishing, the marketplace repo looks like:

```
claude_code_marketplace_demo/
├── marketplace.json
└── plugins/
    └── feature-lifecycle/
        ├── plugin.json
        ├── mcp/
        ├── skills/
        ├── agents/
        └── commands/
```

As more plugins are published, the `plugins/` folder grows and `marketplace.json` is updated to include each new entry.

---

## 7. Install Plugins from a Marketplace (5 min)

Now the other side — how a team installs plugins from a published marketplace into their project using the `/plugin` slash command.

A pre-built marketplace is available at:

```
https://github.com/gravity9-tech/claude_code_marketplace_demo
```

### Step 1: Add the Marketplace

Before you can install plugins, you need to register the marketplace with your project. In Claude Code:

```
/plugin add marketplace https://github.com/gravity9-tech/claude_code_marketplace_demo
```

This registers the marketplace repository as a plugin source for your project. Claude Code will fetch `marketplace.json` from the repo and make all its plugins available for installation.

You only need to add a marketplace **once per project**. After that, all plugins from that marketplace are available.

### Step 2: Browse Available Plugins

To see what plugins are available from your registered marketplaces:

```
/plugin list
```

This reads the `marketplace.json` from each registered marketplace and shows a catalogue of available plugins with their names, descriptions, and component lists.

### Step 3: Install a Plugin

To install a specific plugin from the marketplace:

```
/plugin add feature-lifecycle
```

Claude Code will:
1. Look up `feature-lifecycle` in the registered marketplace(s)
2. Fetch the plugin contents from the marketplace repo
3. Copy skills into `.claude/skills/`
4. Copy agents into `.claude/agents/`
5. Copy commands into `.claude/commands/`
6. Merge MCP configuration into `.mcp.json`

```
Marketplace Repo                          Target Project
(plugins/feature-lifecycle/)              (.claude/)

skills/create-ticket/    ──install──►     skills/create-ticket/
skills/expand-ticket/    ──install──►     skills/expand-ticket/
skills/tdd-workflow/     ──install──►     skills/tdd-workflow/
skills/create-branch/    ──install──►     skills/create-branch/
skills/commit-and-merge/ ──install──►     skills/commit-and-merge/
agents/planner.md        ──install──►     agents/planner.md
agents/tdd-implementer.md──install──►     agents/tdd-implementer.md
agents/code-reviewer.md  ──install──►     agents/code-reviewer.md
commands/implement-feature.md──install──► commands/implement-feature.md
mcp/atlassian.json       ──install──►     .mcp.json (merged)
```

### Step 4: Verify

Restart Claude Code to load the newly installed components:

```bash
/exit
claude
```

Then verify everything was installed:

```
/skills
```

You should see all five skills from the feature-lifecycle plugin listed.

### Remove a Plugin

To remove a previously installed plugin:

```
/plugin remove feature-lifecycle
```

Claude Code will remove the components that were installed by that plugin.

### Quick Reference

| Command | What it does |
|---------|-------------|
| `/plugin add marketplace <url>` | Register a marketplace repo as a plugin source |
| `/plugin list` | Show available plugins from registered marketplaces |
| `/plugin add <name>` | Install a plugin into the current project |
| `/plugin remove <name>` | Remove a previously installed plugin |

> **Tip:** After installing or removing plugins, restart Claude Code (`/exit` then `claude`) to reload the updated skills, agents, and commands.

---

## Architecture Recap

```
┌────────────────────────────────────────────────────────────────┐
│                     PLUGIN LIFECYCLE                            │
│                                                                 │
│  ┌──────────┐   ┌──────────────┐   ┌──────────────────────┐   │
│  │  BUILD   │   │   PACKAGE    │   │      PUBLISH         │   │
│  │ (Mod 2)  │──►│ create-plugin│──►│ Copy to marketplace  │   │
│  │          │   │   skill      │   │ repo + git push      │   │
│  └──────────┘   └──────────────┘   └──────────┬───────────┘   │
│                                                │               │
│                                                ▼               │
│                                     ┌──────────────────────┐   │
│                                     │ MARKETPLACE REPO     │   │
│                                     │ marketplace.json     │   │
│                                     │ plugins/             │   │
│                                     └──────────┬───────────┘   │
│                                                │               │
│                                                ▼               │
│  ┌──────────────────────┐          ┌──────────────────────┐   │
│  │    TARGET PROJECT    │◄─────────│      INSTALL         │   │
│  │ .claude/ (populated) │ /plugin  │ /plugin add market.. │   │
│  │ .mcp.json (merged)   │  add     │ /plugin add <name>   │   │
│  └──────────────────────┘          └──────────────────────┘   │
│                                                                 │
└────────────────────────────────────────────────────────────────┘
```

---

## Final Project Structure

After completing this module:

```
tea-store-demo/
├── .claude/
│   ├── agents/                     # From Module 2
│   ├── commands/                   # From Module 2
│   └── skills/
│       ├── skill-creator/          # Pre-built
│       ├── agent-creator/          # Pre-built
│       ├── command-creator/        # Pre-built
│       ├── create-ticket/          # Module 2
│       ├── expand-ticket/          # Module 2
│       ├── tdd-workflow/           # Module 2
│       ├── create-branch/          # Module 2
│       ├── commit-and-merge/       # Module 2
│       ├── create-plugin/          # NEW — packages components
│       └── create-marketplace/     # NEW — builds marketplace catalogue
├── .claude-plugins/
│   ├── marketplace.json            # NEW — marketplace catalogue
│   └── feature-lifecycle/          # NEW — packaged plugin
│       ├── plugin.json
│       ├── mcp/
│       ├── skills/
│       ├── agents/
│       └── commands/
├── .mcp.json
└── CLAUDE.md
```

---

## Key Takeaways

| Concept | What You Did |
|---------|-------------|
| **create-plugin skill** | Built a skill that packages any combination of components into an installable plugin |
| **Generalisation** | Stripped tech stack specifics so plugins work across teams |
| **plugin.json** | Manifest that declares what a plugin provides and requires |
| **create-marketplace skill** | Built a skill that catalogues plugins into `marketplace.json` |
| **Publishing** | Copy plugin + marketplace to a Git repo, tag, and push |
| **Installing** | `/plugin add marketplace <url>` then `/plugin add <name>` to install into `.claude/` |

### The Two Skills You Built

| Skill | Input | Output |
|-------|-------|--------|
| `create-plugin` | Component selection + plugin name | `.claude-plugins/<name>/` with generalised components and `plugin.json` |
| `create-marketplace` | Scan `.claude-plugins/` | `marketplace.json` cataloguing all plugins |

---

## Next Up

Continue to: [05_ralph_loop_and_lisa.md](./05_ralph_loop_and_lisa.md) — Run the Feature Lifecycle Autonomously
